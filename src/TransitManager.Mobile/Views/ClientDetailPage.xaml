<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:TransitManager.Mobile.ViewModels"
             xmlns:converters="clr-namespace:TransitManager.Mobile.Converters"
             x:DataType="viewmodels:ClientDetailViewModel"
             x:Class="TransitManager.Mobile.Views.ClientDetailPage"
             Title="Détails du Client">

    <ContentPage.Resources>
        <converters:BoolToStringConverter x:Key="BoolToStringConverter"/>
        <converters:IsNotNullOrEmptyConverter x:Key="IsNotNullOrEmptyConverter"/>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Spacing="15" Padding="20">
            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" />

            <Label Text="{Binding Client.NomComplet}" FontSize="Header" FontAttributes="Bold" HorizontalOptions="Center"/>
            <Label Text="{Binding Client.CodeClient}" FontSize="Small" TextColor="Gray" HorizontalOptions="Center"/>
            <BoxView HeightRequest="1" Color="LightGray" Margin="0,10"/>

            <Frame Padding="15" BorderColor="LightGray">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Informations Personnelles" FontSize="Large" FontAttributes="Bold" />
                    <Grid ColumnDefinitions="Auto, *" RowDefinitions="*,*,*,*" RowSpacing="8">
                        <Label Grid.Row="0" Grid.Column="0" Text="Téléphone :" FontAttributes="Bold"/>
                        <Label Grid.Row="0" Grid.Column="1" Text="{Binding Client.TelephonePrincipal}" />
                        
                        <Label Grid.Row="1" Grid.Column="0" Text="Secondaire :" FontAttributes="Bold"/>
                        <Label Grid.Row="1" Grid.Column="1" Text="{Binding Client.TelephoneSecondaire, TargetNullValue='N/A'}" />
                        
                        <Label Grid.Row="2" Grid.Column="0" Text="Email :" FontAttributes="Bold"/>
                        <Label Grid.Row="2" Grid.Column="1" Text="{Binding Client.Email, TargetNullValue='N/A'}" />

                        <Label Grid.Row="3" Grid.Column="0" Text="Commentaires :" FontAttributes="Bold" VerticalOptions="Start"/>
                        <Label Grid.Row="3" Grid.Column="1" Text="{Binding Client.Commentaires, TargetNullValue='Aucun'}" IsVisible="{Binding Client.Commentaires, Converter={StaticResource IsNotNullOrEmptyConverter}}"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <Frame Padding="15" BorderColor="LightGray">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Adresse" FontSize="Large" FontAttributes="Bold" />
                    <Label Text="{Binding Client.AdressePrincipale, TargetNullValue='Non renseignée'}" />
                    <Label>
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="{Binding Client.CodePostal}" />
                                <Span Text=" " />
                                <Span Text="{Binding Client.Ville}" />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                    <Label Text="{Binding Client.Pays}" />
                </VerticalStackLayout>
            </Frame>

            <Frame Padding="15" BorderColor="LightGray">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Statut &amp; Statistiques" FontSize="Large" FontAttributes="Bold" />

                     <Grid ColumnDefinitions="Auto, *" RowDefinitions="*,*,*,*,*,*,*,*" RowSpacing="8">
                        <Label Grid.Row="0" Grid.Column="0" Text="Statut :" FontAttributes="Bold"/>
                        <Label Grid.Row="0" Grid.Column="1" Text="{Binding Client.Actif, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Actif|Inactif'}"/>
                        
                        <Label Grid.Row="1" Grid.Column="0" Text="Client Fidèle :" FontAttributes="Bold"/>
                        <Label Grid.Row="1" Grid.Column="1" Text="{Binding Client.EstClientFidele, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Oui|Non'}"/>
                        
                        <Label Grid.Row="2" Grid.Column="0" Text="Inscrit le :" FontAttributes="Bold"/>
                        <Label Grid.Row="2" Grid.Column="1" Text="{Binding Client.DateInscription, StringFormat='{0:dd/MM/yyyy}'}" />

                        <Label Grid.Row="3" Grid.Column="0" Text="Envois (Cont.) :" FontAttributes="Bold"/>
                        <Label Grid.Row="3" Grid.Column="1" Text="{Binding Client.NombreConteneursUniques}"/>
                        
                        <Label Grid.Row="4" Grid.Column="0" Text="Impayés Colis :" FontAttributes="Bold"/>
                        <Label Grid.Row="4" Grid.Column="1" Text="{Binding ImpayesColis, StringFormat='{0:C}'}" TextColor="Red"/>

                        <Label Grid.Row="5" Grid.Column="0" Text="Impayés Véhicules :" FontAttributes="Bold"/>
                        <Label Grid.Row="5" Grid.Column="1" Text="{Binding ImpayesVehicules, StringFormat='{0:C}'}" TextColor="Red"/>

                        <BoxView Grid.Row="6" Grid.ColumnSpan="2" HeightRequest="1" Color="LightGray" Margin="0,5"/>
                        
                        <Label Grid.Row="7" Grid.Column="0" Text="Total Impayés :" FontAttributes="Bold"/>
                        <Label Grid.Row="7" Grid.Column="1" Text="{Binding Client.Impayes, StringFormat='{0:C}'}" TextColor="Red" FontAttributes="Bold"/>
                    </Grid>

                </VerticalStackLayout>
            </Frame>

			<HorizontalStackLayout Spacing="10" HorizontalOptions="Center" Margin="0,20,0,0">
				<Button Text="Modifier" Command="{Binding EditCommand}"/>

                <Button Text="Actualiser" Command="{Binding LoadClientDetailsCommand}"/>

				<Button Text="Supprimer" Command="{Binding DeleteCommand}" BackgroundColor="Red"/>
			</HorizontalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>