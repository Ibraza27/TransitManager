<mah:MetroWindow x:Class="TransitManager.WPF.MainWindow"
                  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                  xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
                  xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                  mc:Ignorable="d"
                  Title="Transit Manager - Système de Gestion"
                  TitleCharacterCasing="Normal"
                  WindowStartupLocation="CenterScreen"
                  WindowState="Maximized"
                  Height="800" Width="1400"
                  GlowBrush="DodgerBlue"
                  BorderThickness="1"
                  ResizeMode="CanResize"
                  SaveWindowPosition="True"
                  WindowTransitionsEnabled="False">

    <mah:MetroWindow.RightWindowCommands>
        <mah:WindowCommands>
            <!-- Notifications -->
            <Button x:Name="NotificationButton" 
                    ToolTip="Notifications">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Bell" />
                    <Border x:Name="NotificationBadge"
                            Background="Red"
                            CornerRadius="10"
                            Margin="-10,-10,0,0"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Visibility="Collapsed">
                        <TextBlock Text="5" 
                                 Foreground="White" 
                                 FontSize="10"
                                 Margin="5,2"/>
                    </Border>
                </StackPanel>
            </Button>
            
            <!-- Utilisateur connecté -->
            <Button x:Name="UserButton">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Account" Margin="0,0,5,0"/>
                    <TextBlock Text="{Binding CurrentUser.NomComplet}" 
                             VerticalAlignment="Center"/>
                </StackPanel>
                <Button.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Mon Profil" Command="{Binding ShowProfileCommand}">
                            <MenuItem.Icon>
                                <materialDesign:PackIcon Kind="AccountCircle"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Paramètres" Command="{Binding ShowSettingsCommand}">
                            <MenuItem.Icon>
                                <materialDesign:PackIcon Kind="Settings"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem Header="Déconnexion" Command="{Binding LogoutCommand}">
                            <MenuItem.Icon>
                                <materialDesign:PackIcon Kind="Logout"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </Button.ContextMenu>
            </Button>
        </mah:WindowCommands>
    </mah:MetroWindow.RightWindowCommands>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Menu latéral -->
        <Border Grid.Column="0" 
                Background="White"
                BorderBrush="LightGray"
                BorderThickness="0,0,1,0">
            <Grid x:Name="SideMenu" Width="250">
                <Grid.Resources>
                    <Storyboard x:Key="MenuOpenAnimation">
                        <DoubleAnimation Storyboard.TargetProperty="Width" 
                                       From="60" To="250" 
                                       Duration="0:0:0.3">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut"/>
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                    </Storyboard>
                    <Storyboard x:Key="MenuCloseAnimation">
                        <DoubleAnimation Storyboard.TargetProperty="Width" 
                                       From="250" To="60" 
                                       Duration="0:0:0.3">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseIn"/>
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                    </Storyboard>
                </Grid.Resources>
                
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- En-tête du menu -->
                <Border Grid.Row="0" 
                        Background="{DynamicResource PrimaryHueDarkBrush}"
                        Padding="20">
                    <StackPanel>
                        <Image Source="/Resources/Images/logo.png" 
                               Height="60" 
                               Margin="0,0,0,10"/>
                        <TextBlock Text="TRANSIT MANAGER" 
                                 Foreground="White"
                                 FontSize="18"
                                 FontWeight="Bold"
                                 HorizontalAlignment="Center"/>
                        <TextBlock Text="Système de Gestion" 
                                 Foreground="White"
                                 FontSize="12"
                                 Opacity="0.8"
                                 HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Items du menu -->
                <ScrollViewer Grid.Row="1" 
                            VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="0,10">
                        <RadioButton 
                                   IsChecked="True"
                                   Command="{Binding NavigateCommand}"
                                   CommandParameter="Dashboard">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="ViewDashboard" Width="24" Height="24" Margin="20,0,20,0"/>
                                <TextBlock Text="Tableau de bord" VerticalAlignment="Center" FontSize="14"/>
                            </StackPanel>
                        </RadioButton>
                        <RadioButton 
                                   Command="{Binding NavigateCommand}"
                                   CommandParameter="Clients">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="AccountGroup" Width="24" Height="24" Margin="20,0,20,0"/>
                                <TextBlock Text="Clients" VerticalAlignment="Center" FontSize="14"/>
                            </StackPanel>
                        </RadioButton>
                        <!-- (Continuez avec les autres RadioButton) -->
                    </StackPanel>
                </ScrollViewer>

                <!-- Pied du menu -->
                <Border Grid.Row="2" 
                        Background="{DynamicResource MaterialDesignToolBarBackground}"
                        Padding="10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <Button x:Name="ToggleMenuButton"
                                Style="{StaticResource MaterialDesignFlatButton}"
                                HorizontalAlignment="Center"
                                Click="ToggleMenuButton_Click">
                            <materialDesign:PackIcon Kind="MenuOpen" />
                        </Button>
                        
                        <TextBlock Grid.Row="1"
                                 x:Name="VersionText"
                                 Text="Version 1.0.0"
                                 FontSize="10"
                                 Opacity="0.6"
                                 HorizontalAlignment="Center"
                                 Margin="0,5,0,0"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Zone de contenu principal -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Barre de recherche globale -->
            <Border Grid.Row="0" Background="{DynamicResource MaterialDesignToolBarBackground}" Padding="20,10">
                <!-- ... contenu de la barre de recherche ... -->
            </Border>

            <!-- !! C'EST L'ÉLÉMENT QUI MANQUAIT PROBABLEMENT !! -->
            <Frame Grid.Row="1" 
                   x:Name="MainFrame"
                   NavigationUIVisibility="Hidden"
                   Margin="10"/>

            <!-- Barre de statut -->
            <StatusBar Grid.Row="2">
                <StatusBar.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                        </Grid>
                    </ItemsPanelTemplate>
                </StatusBar.ItemsPanel>
                
                <StatusBarItem Grid.Column="0">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Connection" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBlock Text="Connecté" />
                    </StackPanel>
                </StatusBarItem>
                
                <StatusBarItem Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding StatusMessage}" />
                </StatusBarItem>
                
                <Separator Grid.Column="2" />
                
                <StatusBarItem Grid.Column="3">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Sync" VerticalAlignment="Center" Margin="0,0,5,0">
                            <!-- *** LA CORRECTION EST ICI : on s'assure que le RotateTransform a le bon nom *** -->
                            <materialDesign:PackIcon.RenderTransform>
                                <RotateTransform x:Name="SyncRotateTransform" Angle="0" CenterX="12" CenterY="12"/>
                            </materialDesign:PackIcon.RenderTransform>
                        </materialDesign:PackIcon>
                        <TextBlock Text="Synchronisé" />
                    </StackPanel>
                </StatusBarItem>
                
                <StatusBarItem Grid.Column="4">
                    <TextBlock Text="{Binding Source={x:Static System:DateTime.Now}, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" />
                </StatusBarItem>
            </StatusBar>
        </Grid>
    </Grid>
</mah:MetroWindow>