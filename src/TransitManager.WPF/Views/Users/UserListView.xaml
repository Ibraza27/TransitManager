<!-- src/TransitManager.WPF/Views/Users/UserListView.xaml -->

<UserControl x:Class="TransitManager.WPF.Views.Users.UserListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- En-tête -->
        <materialDesign:Card Grid.Row="0" Padding="16" Margin="16,16,16,0">
            <Grid>
                <TextBlock Text="Gestion des Utilisateurs" Style="{StaticResource MaterialDesignHeadline5TextBlock}" VerticalAlignment="Center"/>
                <Button Style="{StaticResource MaterialDesignRaisedButton}" Command="{Binding NewUserCommand}" HorizontalAlignment="Right">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="AccountPlus" Margin="0,0,5,0"/>
                        <TextBlock Text="Nouvel Utilisateur"/>
                    </StackPanel>
                </Button>
            </Grid>
        </materialDesign:Card>

		<!-- Barre de recherche et filtres -->
		<materialDesign:Card Grid.Row="1" Margin="16,8,16,0" Padding="16">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="Auto"/>
				</Grid.ColumnDefinitions>

				<TextBox Grid.Column="0" 
						 materialDesign:HintAssist.Hint="Rechercher (nom, email...)"
						 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
						 Style="{StaticResource MaterialDesignOutlinedTextBox}"/>

				<ComboBox Grid.Column="1" 
						  materialDesign:HintAssist.Hint="Rôle"
						  ItemsSource="{Binding RolesList}"
						  SelectedItem="{Binding SelectedRole}"
						  Style="{StaticResource MaterialDesignOutlinedComboBox}"
						  Width="150" Margin="10,0"/>

				<Button Grid.Column="2"
						Command="{Binding ClearFiltersCommand}"
						Style="{StaticResource MaterialDesignFlatButton}">
					<StackPanel Orientation="Horizontal">
						<materialDesign:PackIcon Kind="FilterRemove" Margin="0,0,5,0"/>
						<TextBlock Text="Effacer"/>
					</StackPanel>
				</Button>
			</Grid>
		</materialDesign:Card>
        
        <!-- Liste des utilisateurs -->
        <DataGrid Grid.Row="2" Margin="16,8,16,16" 
                  ItemsSource="{Binding Users}" 
                  IsReadOnly="True" AutoGenerateColumns="False" 
                  Style="{StaticResource MaterialDesignDataGrid}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Nom d'utilisateur" Binding="{Binding NomUtilisateur}" Width="*" FontWeight="Bold"/>
                <DataGridTextColumn Header="Nom Complet" Binding="{Binding NomComplet}" Width="2*"/>
                <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="2*"/>
                <DataGridTextColumn Header="Téléphone" Binding="{Binding Telephone}" Width="*"/>
                <DataGridTextColumn Header="Rôle" Binding="{Binding Role}" Width="*"/>
                <DataGridCheckBoxColumn Header="Actif" Binding="{Binding Actif}" Width="Auto"/>
				<DataGridTemplateColumn Header="Actions">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal">
								<Button Style="{StaticResource MaterialDesignIconButton}" 
										Command="{Binding DataContext.EditUserCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" 
										CommandParameter="{Binding}">
									<materialDesign:PackIcon Kind="Pencil"/>
								</Button>
								<!-- AJOUTER CE BOUTON -->
								<Button Style="{StaticResource MaterialDesignIconButton}" 
										Command="{Binding DataContext.DeleteUserCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" 
										CommandParameter="{Binding}">
									<materialDesign:PackIcon Kind="Delete" Foreground="{StaticResource ErrorBrush}"/>
								</Button>
							</StackPanel>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</UserControl>