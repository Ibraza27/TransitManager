@page "/forgot-password"
@layout EmptyLayout
@inject IApiService ApiService

<div class="card p-4 shadow-sm" style="max-width: 400px; margin: 50px auto;">
    <h3 class="text-center mb-4">Mot de passe oublié ?</h3>
    <p class="text-muted text-center small">Entrez votre email pour recevoir un lien de réinitialisation.</p>
    
    @if (_sent)
    {
        <div class="alert alert-success">Si ce compte existe, un email a été envoyé.</div>
        <a href="login" class="btn btn-primary w-100">Retour à la connexion</a>
    }
    else
    {
        <div class="mb-3">
            <label>Email</label>
            <input @bind="_email" class="form-control" type="email" placeholder="votre@email.com" />
        </div>
        <button class="btn btn-primary w-100" @onclick="SendRequest" disabled="@_isBusy">
            @if(_isBusy) { <span>Envoi...</span> } else { <span>Envoyer le lien</span> }
        </button>
        <a href="login" class="d-block text-center mt-3 small">Annuler</a>
    }
</div>

@code {
    private string _email = "";
    private bool _isBusy = false;
    private bool _sent = false;

    private async Task SendRequest()
    {
        if (string.IsNullOrWhiteSpace(_email)) return;
        _isBusy = true;
        await ApiService.ForgotPasswordAsync(_email);
        _sent = true;
        _isBusy = false;
    }
}